<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Docker CI Test Results Dashboard</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            color: #333;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        .status-card {
            display: inline-block;
            margin: 10px;
            padding: 20px;
            border-radius: 8px;
            min-width: 200px;
            text-align: center;
        }
        .success { background-color: #d4edda; border: 1px solid #c3e6cb; }
        .failure { background-color: #f8d7da; border: 1px solid #f5c6cb; }
        .info { background-color: #d1ecf1; border: 1px solid #bee5eb; }
        .logs {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Docker CI Integration Test Dashboard</h1>
            <p>Real-time monitoring of integration test results</p>
        </div>

        <div id="status-section">
            <div class="status-card info">
                <h3>Application Status</h3>
                <div id="app-status">Checking...</div>
            </div>
            <div class="status-card info">
                <h3>Database Status</h3>
                <div id="db-status">Checking...</div>
            </div>
            <div class="status-card info">
                <h3>Last Test Run</h3>
                <div id="test-status">Checking...</div>
            </div>
        </div>

        <div>
            <button onclick="refreshStatus()">Refresh Status</button>
            <button onclick="runTests()">Run Tests</button>
            <button onclick="viewLogs()">View Logs</button>
        </div>

        <div id="logs-section">
            <h3>System Logs</h3>
            <div id="logs" class="logs">Click "View Logs" to see recent logs...</div>
        </div>
    </div>

    <script>
        async function checkAppStatus() {
            try {
                const response = await fetch('/health');
                const data = await response.json();
                document.getElementById('app-status').innerHTML = 
                    `<span style="color: green;">✓ Healthy</span><br>
                     <small>${data.timestamp}</small>`;
            } catch (error) {
                document.getElementById('app-status').innerHTML = 
                    `<span style="color: red;">✗ Unhealthy</span><br>
                     <small>${error.message}</small>`;
            }
        }

        async function checkDbStatus() {
            try {
                const response = await fetch('/db-status');
                const data = await response.json();
                document.getElementById('db-status').innerHTML = 
                    `<span style="color: green;">✓ Connected</span><br>
                     <small>${data.timestamp}</small>`;
            } catch (error) {
                document.getElementById('db-status').innerHTML = 
                    `<span style="color: red;">✗ Disconnected</span><br>
                     <small>${error.message}</small>`;
            }
        }

        function refreshStatus() {
            checkAppStatus();
            checkDbStatus();
            document.getElementById('test-status').innerHTML = 
                `<span style="color: blue;">Last checked: ${new Date().toLocaleString()}</span>`;
        }

        function runTests() {
            document.getElementById('logs').textContent = 'Running integration tests...\n';
            // In a real implementation, this would trigger the test pipeline
            setTimeout(() => {
                document.getElementById('logs').textContent += 
                    'Tests completed successfully!\n' +
                    'All integration tests passed.\n' +
                    'Database connectivity: OK\n' +
                    'API endpoints: OK\n';
            }, 3000);
        }

        function viewLogs() {
            document.getElementById('logs').textContent = 
                'Loading recent logs...\n' +
                '[2024-01-15 10:30:15] INFO: Application started\n' +
                '[2024-01-15 10:30:16] INFO: Database connection established\n' +
                '[2024-01-15 10:30:17] INFO: Health check endpoint ready\n' +
                '[2024-01-15 10:30:18] INFO: Integration tests started\n' +
                '[2024-01-15 10:30:25] INFO: All tests passed\n';
        }

        // Initialize dashboard
        refreshStatus();
        setInterval(refreshStatus, 30000); // Refresh every 30 seconds
    </script>
</body>
</html>