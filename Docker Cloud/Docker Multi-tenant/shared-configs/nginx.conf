events {
    worker_connections 1024;
}

http {
    upstream tenant_a {
        server tenant-a-compose:5000;
    }
    
    upstream tenant_b {
        server tenant-b-compose:3000;
    }
    
    upstream tenant_c {
        server tenant-c-compose:80;
    }

    server {
        listen 80;
        server_name tenant-a.local;
        
        location / {
            proxy_pass http://tenant_a;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }
    }

    server {
        listen 80;
        server_name tenant-b.local;
        
        location / {
            proxy_pass http://tenant_b;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }
    }

    server {
        listen 80;
        server_name tenant-c.local;
        
        location / {
            proxy_pass http://tenant_c;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }
    }

    server {
        listen 80 default_server;
        
        location /tenant-a {
            proxy_pass http://tenant_a/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }
        
        location /tenant-b {
            proxy_pass http://tenant_b/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }
        
        location /tenant-c {
            proxy_pass http://tenant_c/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }
        
        location / {
            return 200 'Multi-Tenant Application Gateway\nAvailable endpoints:\n/tenant-a\n/tenant-b\n/tenant-c\n';
            add_header Content-Type text/plain;
        }
    }
}